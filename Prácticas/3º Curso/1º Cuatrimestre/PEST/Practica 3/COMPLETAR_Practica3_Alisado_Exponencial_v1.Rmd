---
title: "Procesos Estocásticos y Series Temporales"
subtitle: "Práctica 3: Métodos de Alisado Exponencial"
author: "Francisco Javier Mercader Martínez"
# date: " "
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


**PRÁCTICA 3 PARA COMPLETAR**

PROCESOS ESTOCÁSTICOS Y SERIES TEMPORALES

GRADO EN CIENCIA E INGENIERÍA DE DATOS


# Ejemplos de los métodos de alisado exponencial con R

## 1. Alisado exponencial simple

Consideremos la serie de datos "LakeHuron" de R:

```{r}
ts.plot(LakeHuron, 
        gpars = list(xlab = "Year", 
                   ylab = "Level LakeHuron in feet", 
                   lwd = 1.5))
```

Método de alisado exponencial simple:

```{r}
ejemplo_aes <- HoltWinters(LakeHuron, beta = FALSE, gamma = FALSE)
  
ejemplo_aes
```
Suma de cuadrados residual para el alpha óptimo:

```{r}
ejemplo_aes$SSE
```
Predicciones para los siguientes 5 años:

```{r}
predict(ejemplo_aes, n.ahead = 5)
```
Representación gráfica de valores reales y predicciones:

```{r}
ts.plot(LakeHuron, xlim = c(1875, 1977),
        gpars = list(xlab = "Year",
                     ylab = "Level LakeHuron in feet",
                     lwd = 1.5))

lines(ejemplo_aes$fitted[ , 1], col = "blue", lwd = 1.2)
lines(predict(ejemplo_aes, n.ahead = 5), col = "red", lwd = 1.2)
```

## 2. Método de Holt

Consideraremos la serie:  

```{r}
library(ggplot2)
# ts.plot(economics$uempmed)
plot(economics$date,economics$uempmed, type = "l")
```

Método de Holt:

```{r}
ejemplo_Holt <- HoltWinters(economics$uempmed, gamma = FALSE)
ejemplo_Holt
```
Suma de cuadrados residual para los parámetros de alisado óptimos:

```{r}
ejemplo_Holt$SSE
```
Predicciones para los siguientes 6 meses. 

```{r}
predict(ejemplo_Holt, n.ahead = 6)

```

Gráfico de serie original y predicciones:

```{r}
ts.plot(economics$uempmed)
lines(ejemplo_Holt$fitted[ , 1], col = "blue")
lines(predict(ejemplo_Holt, n.ahead = 6), col = "red")
```




## 3. Método de Holt-Winters multiplicativo

Serie temporal "AirPassengers" incluida en R:

```{r}
ts.plot(AirPassengers)  
```

Método de Holt-Winters multiplicativo: 
```{r}
class(AirPassengers) #comprobamos que sí es de clase ts
ejemplo_HW_mult <- HoltWinters(AirPassengers, seasonal = "multiplicative")
ejemplo_HW_mult
```

Suma de cuadrados residual para los parámetros de alisado óptimos:

```{r}
ejemplo_HW_mult$SSE
```

Predicciones para los siguientes 12 meses:

```{r}
predict(ejemplo_HW_mult, n.ahead = 12)

```

Gráfico de serie original y  predicciones:

```{r}
ts.plot(AirPassengers, xlim = c(1949, 1962), ylim = c(100, 800))
lines(ejemplo_HW_mult$fitted[ , 1], col = "blue")
lines(predict(ejemplo_HW_mult, n.ahead = 12), col = "red")
```

## 4. Método de Holt-Winters aditivo

Serie "AirPassengers", pero transformados tomando logaritmos neperianos. 

```{r}
Pasajeros_aditivo <- log(AirPassengers)
ts.plot(Pasajeros_aditivo)
```

Método Holt-Winters aditivo:

```{r}
ejemplo_HW_aditivo <- HoltWinters(Pasajeros_aditivo, seasonal = 'additive')
ejemplo_HW_aditivo
```

Y las predicciones del próximo año serán:

```{r}
predict(ejemplo_HW_aditivo, n.ahead = 12)
```


# Modelos ETS (Error, Trend, Seasonal)

Análisis de la serie "Pasajeros_aditivo" que vimos en una sección anterior. 

Usaremos el modelo ETS(A,A,A):

```{r}
library(forecast)
ejemplo_ETS_AAA <- ets(Pasajeros_aditivo, model = "AAA")
ejemplo_ETS_AAA

```
Intervalos de predicción para los próximos 12 meses con el modelo ETS:

```{r}
forecast(ejemplo_ETS_AAA, h = 12, level = 0.95)
```

Representamos la serie original y predicciones:

```{r}
plot(forecast(ejemplo_ETS_AAA, h = 12, level = 0.95))
lines(ejemplo_ETS_AAA$fitted, col = "blue")
```

Veamos para la serie "Pasajeros_aditivo" la búsqueda automática del modelo:

```{r}
busqueda_ETS <- ets(Pasajeros_aditivo)
busqueda_ETS
```

Comparación de errores:

```{r}
sum((Pasajeros_aditivo - busqueda_ETS$fitted)^2)
sum(ejemplo_ETS_AAA$residuals^2)
```

