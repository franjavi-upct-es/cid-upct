---
title: "Control 2 de Prácticas"
author: "Francisco Javier Mercader Martínez"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = 'center', warning = FALSE)
```

```{r, include=FALSE}
library("MASS")
library("mvnormtest")
```

# Problema 1

1)  

```{r, fig.height=10, fig.width=10}
d <- read.csv("data/wine_A.csv", header = TRUE, sep = ";", dec = ",")

# Nos podremos planterar un análisis de componentes principales si las variables presentan correlación.

str(d)
plot(d, pch=20, cex=0.8)
```

Podemos observar un par de variables correlado (`Total.phenols` y `Flavanoids`), aunque no de manera muy estrecha.

2)  

```{r}
cov(d)
cor(d)
```

Considero que la matriz de correlaciones es más apropiada ya que es mejor utilizar los datos tipificados.

Para saber si las correlaciones anteriores son significativas, podemos usar la función *rcorr()* del paquete *Hmisc*, para obtener tanto el valor de las correlaciones como el p-valor del contraste de significación de cada correlación.

```{r, message=FALSE}
library("Hmisc")
rcorr(as.matrix(d))
```

Observamos varios p-valores inferiores a 0.05, lo que indica que las correspondiente correlaciones son significativas, por lo tanto existe correlación entre algunas variables.

3)  

```{r}
PCA <- princomp(d, cor = TRUE)
summary(PCA)
```

La proporción de variabilidad total explicada por las 4 primeras componentes principales equivale a un 67.71%

4)  

```{r}
S <- PCA$scores
which.max(S[, 1])
which.min(S[, 1])
```

5)  

```{r}
SAT <- cor(d, S)

mejor_variable <- apply(SAT, 2, function(x) which.max(abs(x)))

peor_variable <- apply(SAT, 2, function(x) which.min(abs(x)))

for (i in 1:3) {
  print(paste("Variable mejor representada por la componente", i, ":", colnames(d)[mejor_variable[i]]))
  print(paste("Variable peor representada por la componente", i, ":", colnames(d)[peor_variable[i]]))
}
```

6)  

```{r}
# Grafo de sedimentación
screeplot(PCA, col="#007AFF")
```

Es posible que sea conveniente considerar sólo las 3 primeras variables ya que la proporción de variabilidad del resto es mucho menor

7)  

```{r}
COM3 = SAT[, 1]^2 + SAT[, 2]^2 + SAT[, 3]^2 # comunalidades si retenemos 3 componentes
COM3

print(paste("Variable mejor representada", colnames(d)[which.max(COM3)]))
print(paste("Variable peor representada:", colnames(d)[which.min(COM3)]))
```

8)  

```{r}
COM2 = SAT[, 1]^2 + SAT[, 2]^2
COM2
```

# Problema 2

1)  

```{r, fig.width=10}
X1 <- d$Alcohol
X2 <- d$Flavanoids
X3 <- d$Color.intensity

par(mfrow = c(1,3))
boxplot(X1 ~ d$wine_class)
boxplot(X2 ~ d$wine_class)
# boxplot(X3 ~ d$wine_class)
```

Para cada una de las variables se pude separar la `clase 2` de las otras porque no se solapan los gráficos de caja.

2)  

```{r}
plot(X2, X3, pch = as.integer(d$wine_class))
legend("bottomright", legend = unique(d$wine_class), pch = 1:3, col = c("#007AFF", "#FF0000", "#0000FF"))
```

3)  


```{r}
LDA <- lda(x = d[1:178, c("Alcohol", "Flavanoids", "Color.intensity")], grouping = d[1:178, 1], prior = c(1/3, 1/3, 1/3))
```

a.  

```{r}
LDA$scaling
```

b. 

```{r}
z = c(13, 1, 15)
predict(LDA, z)
```
Se clasificaría en la clase 3 y la clasificación sería muy fiable

c. 

```{r}
plot(LDA)
points(predict(LDA, z)$x[1, 1], predict(LDA, z)$x[1,2], pch = 19, col = "#007AFF")
```
Se clasificaría en el grupo 3

4) 

```{r}
QDA <- qda(x = d[1:178, c("Alcohol", "Flavanoids", "Color.intensity")], grouping = d[1:178, 1], prior = c(1/3, 1/3, 1/3))
```

a. 

```{r}
z = c(13, 1, 15)
predict(QDA, z)
```

Se clasificaría en la clase 3 y la clasificación sería muy fiable

5)

```{r}
LDACV <- lda(x = d[1:178, c("Alcohol", "Flavanoids", "Color.intensity")], grouping = d[1:178, 1], prior = c(1/3, 1/3, 1/3), CV=TRUE)
QDACV <- qda(x = d[1:178, c("Alcohol", "Flavanoids", "Color.intensity")], grouping = d[1:178, 1], prior = c(1/3, 1/3, 1/3), CV=TRUE)

table(LDACV$class, d$wine_class)
table(QDACV$class, d$wine_class)
```
6) 

```{r}
library("dplyr")
d1 = d %>%
  filter(wine_class == 1)
d2 = d %>%
  filter(wine_class == 2)
d3 = d %>%
  filter(wine_class == 3)

cov(d1[, c("Alcohol", "Flavanoids", "Color.intensity")])
cov(d2[, c("Alcohol", "Flavanoids", "Color.intensity")])
cov(d3[, c("Alcohol", "Flavanoids", "Color.intensity")])
```
```{r}
library("mvnormtest")
mshapiro.test(t(d1[, c("Alcohol", "Flavanoids", "Color.intensity")]))
mshapiro.test(t(d2[, c("Alcohol", "Flavanoids", "Color.intensity")]))
mshapiro.test(t(d3[, c("Alcohol", "Flavanoids", "Color.intensity")]))
```

