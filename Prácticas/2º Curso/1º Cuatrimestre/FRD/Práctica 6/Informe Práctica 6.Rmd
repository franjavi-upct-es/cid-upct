---
title: "Fundamentos de Redes de Datos"
subtitle: "Práctica 6: Creación de redes LAN mediante herramientas de virtualización - Maquinas Virtuales"
author: "Francisco Javier Mercader Martínez"
output: 
  pdf_document:
    latex_engine: xelatex
geometry: margin=1.5cm, a4paper
fontsize: 12pt
header-includes:
- \renewcommand{\and}{\\}
- \usepackage{fvextra}
- \usepackage{hyperref}
- \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines, commandchars=\\\{\}}
---

# 6. Modo de red: NAT

## Tarea 6.1

-   Utilizando la máquina virtual FDR1, configúrale como tarjeta de red \underline{el segundo adaptador} en modo NAT.

    ![](figures/Captura%20de%20pantalla%202024-12-21%20174032.png)

-   Arranca la máquina virutal. Consulta y anota la dirección IP asignada a la tarjeta de red. Para consultar la configuración de las tarjetas de red en una máquina con sistema operativo Linux emplea el comando **`ip`** (**`#ip a`**). ¿Cumple con el esquema de numeración por defecto empleado por VirtualBox?

``` bash
localhost:~ # ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:69:fa:2b brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute eth0
       valid_lft 85911sec preferred_lft 85911sec
    inet6 fe80::e167:c6d8:d4b7:c78f/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: eth5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:12:03:cd brd ff:ff:ff:ff:ff:ff
    inet 10.0.3.15/24 brd 10.0.3.255 scope global dynamic noprefixroute eth5
       valid_lft 85911sec preferred_lft 85911sec
    inet6 fe80::6d09:b862:1296:65f/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```

La IP es `10.03.15` porque hemos actividado la tarjeta 2 y el plan de direccionamiento se cumple.

-   Consulta y anota la dirección IP del anfitrión. **`#ip a`**

    **`192.168.56.1`**

-   Haz un ping desde la máquina virtual anfitrión. ¿Ha tenido éxito?

    ``` bash
    localhost:/home/fdr1 # ping 192.168.56.1
    PING 192.168.56.1 (192.168.56.1) 56(84) bytes of data.
    64 bytes from 192.168.56.1: icmp_seq=1 ttl=127 time=5.85 ms
    64 bytes from 192.168.56.1: icmp_seq=2 ttl=127 time=2.05 ms
    64 bytes from 192.168.56.1: icmp_seq=3 ttl=127 time=1.81 ms
    64 bytes from 192.168.56.1: icmp_seq=4 ttl=127 time=1.34 ms
    64 bytes from 192.168.56.1: icmp_seq=5 ttl=127 time=1.18 ms
    64 bytes from 192.168.56.1: icmp_seq=6 ttl=127 time=3.73 ms
    64 bytes from 192.168.56.1: icmp_seq=7 ttl=127 time=1.96 ms
    64 bytes from 192.168.56.1: icmp_seq=8 ttl=127 time=1.69 ms
    64 bytes from 192.168.56.1: icmp_seq=9 ttl=127 time=1.30 ms
    64 bytes from 192.168.56.1: icmp_seq=10 ttl=127 time=2.26 ms
    64 bytes from 192.168.56.1: icmp_seq=11 ttl=127 time=2.07 ms
    64 bytes from 192.168.56.1: icmp_seq=12 ttl=127 time=3.27 ms
    ^C
    --- 192.168.56.1 ping statistics ---
    12 packets transmitted, 12 received, 0% packet loss, time 11127ms
    rtt min/avg/max/mdev = 1.182/2.374/5.845/1.274 ms
    ```

    En la máquina virtual si tenemos éxito.

-   Haz un ping desde la máquina anfitrión a la máquina virtual. ¿Ha tenido éxito?

    ``` bash
    (base) PS C:\Users\fcoja> ping 10.0.3.15

    Haciendo ping a 10.0.3.15 con 32 bytes de datos:
    Tiempo de espera agotado para esta solicitud.
    Tiempo de espera agotado para esta solicitud.
    Tiempo de espera agotado para esta solicitud.
    Tiempo de espera agotado para esta solicitud.

    Estadísticas de ping para 10.0.3.15:
        Paquetes: enviados = 4, recibidos = 0, perdidos = 4
        (100% perdidos),
    ```

    No hay conexión de fuera hacia dentro, que lo hacemos en modo NAT.

## Tarea 6.2

-   Instalar un servidor ssh en la máquina virtual FDR1. SSH *(Secure SHell)* es un servicio más avanzado que permite la conexión remota:

    ``` bash
    localhost:/home/fdr1 # zypper install openssh
    Cargando datos del repositorio...
    Leyendo los paquetes instalados...
    'openssh' ya está instalado.
    ```

-   Añadir la iniciación del servidor telnet al sistema de arranque:

    ``` bash
    localhost:/home/fdr1 # systemctl start sshd
    localhost:/home/fdr1 # systemctl status sshd
    ● sshd.service - OpenSSH Daemon
         Loaded: loaded (/usr/lib/systemd/system/sshd.service; disabled; preset: disabled)
         Active: active (running) since Sat 2024-12-21 17:50:25 CET; 5s ago
        Process: 5551 ExecStartPre=/usr/sbin/sshd-gen-keys-start (code=exited, status=0/SUCCESS)
        Process: 5554 ExecStartPre=/usr/sbin/sshd -t $SSHD_OPTS (code=exited, status=0/SUCCESS)
       Main PID: 5556 (sshd)
          Tasks: 1
            CPU: 395ms
         CGroup: /system.slice/sshd.service
                 └─5556 "sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups"

    dic 21 17:50:25 localhost.localdomain systemd[1]: Starting OpenSSH Daemon...
    dic 21 17:50:25 localhost.localdomain sshd-gen-keys-start[5551]: Checking for missing server keys in /etc/ssh
    dic 21 17:50:25 localhost.localdomain sshd-gen-keys-start[5552]: ssh-keygen: generating new host keys: RSA EC>
    dic 21 17:50:25 localhost.localdomain sshd[5556]: Server listening on 0.0.0.0 port 22.
    dic 21 17:50:25 localhost.localdomain sshd[5556]: Server listening on :: port 22.
    dic 21 17:50:25 localhost.localdomain systemd[1]: Started OpenSSH Daemon.
    localhost:/home/fdr1 # systemctl enable sshd
    Created symlink /etc/systemd/system/multi-user.target.wants/sshd.service → /usr/lib/systemd/system/sshd.service.
    ```

-   Emplear la opción de reenvío de puertos ofrecida por VirtualBox para permitir la conexión telnet a la máquina virtual desde la máquina anfitrión. El puerto TCP asociado al servicio ssh es el puerto 22

-   ¿Cómo puedes comprobar la correcta ejecución de esta tarea?

    ``` bash
    localhost:/home/fdr1 # ssh fdr1@10.0.3.15
    The authenticity of host '10.0.3.15 (10.0.3.15)' can't be established.
    ED25519 key fingerprint is SHA256:Oi6r5AhwwO3K79WmnePAnaxCIUIVquCM9uwrz70J1yQ.
    This key is not known by any other names.
    Are you sure you want to continue connecting (yes/no/[fingerprint])? y
    Please type 'yes', 'no' or the fingerprint: yes
    Warning: Permanently added '10.0.3.15' (ED25519) to the list of known hosts.
    (fdr1@10.0.3.15) Password: 
    Have a lot of fun...
    ```

-   Apaga la máquina virtual.

## Tarea 7.1

-   Crea una red NAT a la que se conectarán las máquinas virtuales FRD1 y FRD2 mediante su primer adaptador (deshabilita el segundo adaptador de red de FRD1, empleado en el apartado anterior).

    ![](figures/Captura%20de%20pantalla%202024-12-21%20183923.png)

-   Arranca ambas máquinas virtuales. Consulta y anota la dirección IP asignada a cada una de ellas.

    ``` bash
    fdr1@localhost:~> ip a
    1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
           valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host noprefixroute 
           valid_lft forever preferred_lft forever
    2: eth2: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
        link/ether 08:00:27:b6:b3:20 brd ff:ff:ff:ff:ff:ff
        altname enp0s3
    3: ovs-system: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
        link/ether 06:54:95:33:12:2f brd ff:ff:ff:ff:ff:ff
    4: s1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000
        link/ether 82:60:53:d4:67:4a brd ff:ff:ff:ff:ff:ff
    ```

    ``` bash
    ```

-   Haz un ping desde una máquina virtual de la red NAT a la máquina anfitrión. ¿Ha tenido éxito?

-   Haz un ping desde la máquina anfitrión a una máquina virtual de la red NAT. ¿Ha tenido éxito?

-   Haz un ping desde una máquina virtual de la red NAT a otra. ¿Ha tenido éxito?

-   Apaga ambas máquinas virtuales.
